drasyl {
  # The network ID is an integer number which isolates drasyl networks. Connections between nodes
  # will occur only if both peers use the same network ID. The main network has ID 1. If you supply
  # your own custom network ID which is different than the main network, your nodes will not connect
  # to other nodes and form a private network. If you’re planning to create your own network on the
  # Internet, it’s best to choose a network ID that isn’t already used.
  # Note: Make sure that the configured Super Peers use the same network ID.
  network.id = -25421

  # Each node has a unique identity. It is composed of a public-private key pair. The address
  # of the node is derived from the public key. In a future release, messages will be signed
  # and encrypted with it.
  identity {
    # This proof of work can be can be provided as evidence that work has been put into
    # the creation of the identity. (-1 := null)
    proof-of-work = -1

    # This public key can be announced to other nodes so that they can send messages to this
    # node.
    public-key = ""

    # This private key must be kept secret. Otherwise, other nodes may use this node's identity
    # to sign and decrypt messages.
    private-key = ""

    # Path to the file with the identity. Is only read if public-key and private-key are
    # empty. If the file does not exist, a new key pair is generated and stored in the file.
    path = "drasyl.identity.json"
  }

  # The drasyl node can use UDP to discover and communicate with other peers.
  remote {
    # If you disable UDP, no interaction with non-local nodes is possible!
    enabled = true

    # IP address that the server should listen on.
    bind-host = "0.0.0.0"

    # The port that the server should listen on. A port number of `0` means that the port number
    # is automatically allocated. However, a random port makes the automatic discovery of this node
    # more difficult.
    bind-port = 22527

    # Contains a list of (public) URLs where this node can be reached. May be necessary if the
    # node is used behind a proxy. The node sends this list to other nodes so that they can
    # connect to it more easily. If this list remains empty, the node will attempt to discover its
    # (public) endpoints automatically.
    # TODO: These endpoints are currently not used. They will be used in a future release.
    endpoints = [] # example value: ["udp://192.168.178.112:22527", "udp://behind.proxy.de:12345"]

    # If this option is enabled, drasyl tries to automatically create a port mapping on discovered
    # UPnP-IGD/NAT-PMP/PCP devices. Disabling this option makes the automatic discovery of this node
    # more difficult. If you create a super-peer node, it is recommended to disable this ption and
    # open a static port by yourself. If you are on a public or corporate network, this feature will
    # probably not work (is denied). In this case, we recommend disabling this function.
    expose.enabled = true

    # The individual nodes send each other ping messages for the discovery and maintaining of NAT
    # holes.
    ping {
      # Determine how often this node will send ping messages to peers. Too long intervals can lead
      # to unrealiable connections. Therefore we recommend not to change this value. Must be a
      # positive value.
      interval = 5s

      # Specify the maximum time the node should wait for a response to ping messages before the
      # peer is considered unreachable and removed from the neighborhood list. Must be a positive
      # value.
      timeout = 30s

      # Defines how long the node sends ping messages to other peers without application
      # communication. Must be a positive value.
      communication-timeout = 60s

      # Defines the maximum number of peers to be sent ping messages simultaneously. Set to 0 to
      # allow unlimited number of connections.
      max-peers = 100
    }

    # Defines how often this node should try to support the sending and receiving peers to establish
    # a direct connection by using NAT hole punching when relaying messages.
    # An interval of 0 deactivates the support.
    unite.min-interval = 20s

    # The node can register itself to a so-called super peer, which acts as a registry for nodes on
    # the network, a default gateway for messages, and will support with NAT hole punching.
    super-peer {
      # When enabled, the node attempts to register itself to the super peer via the endpoint listed
      # below. This node cannot act as a super peer for other nodes as long as this option is
      # enabled.
      enabled = true

      # Endpoints that is used to connect to the super peer.
      # Note: Make sure that the configured super peer uses the same network ID as this node.
      endpoint = "udp://staging.env.drasyl.org#03096ae3080a369829a44847d5af1f652bef3f9921e9e1bbad64970babe6d3c502"
    }

    message {
      # The MTU size does not include the IP (20 to 60 bytes) or UDP overhead (8 bytes). Should not
      # be too large, as this increases the probability that network devices will consider the UDP
      # datagram to be too large and therefore discard it.
      # Note: this size does not define the maximum message size that can be sent by our node (see
      # drasyl.message.max-content-length)
      # Explanation for the default value:
      # - Google Cloud is the "big player" with the smallest MTU of 1460 bytes (see
      # https://cloud.google.com/network-connectivity/docs/vpn/concepts/mtu-considerations).
      # - The IP header is 20 bytes long (thanks to google cloud for only support IPv4!).
      # - The UDP header is 8 bytes long
      # - This gives us a maximum MTU of 1432 bytes
      mtu = 1432B

      # Specifies the maximum length of a single message. The node will discard larger messages
      # before sending and receiving. All nodes in the network should have use the same max length
      # value. Messages that do not fit into a single UDP datagram are automatically chunked and
      # sent in multiple datagrams.
      # Set to 0 to have no limit.
      # Note: For technical reasons, this value must not be more than 2^16-1 times the selected MTU
      # size above.
      max-content-length = 500KiB

      # The maximum amount of time this node waits for receiving a all chunks of a composed message.
      # If the message chunks does not arrive in this time, the message and all existing and
      # following chunks are dropped.
      composed-message-transfer-timeout = 1m

      # Limits the lifespan of a message and prevents it from circulating indefinitely on the
      # network. Every outgoing message starts with the value defined here. Each node decreases the
      # message's hop-limit value before routing it to the next node. If the hop-limit value reaches
      # zero before the message arrives at its destination, then the message is discarded.
      hop-limit = 8
    }

    throttle {
      # Outbound traffic rate limit. Outbound traffic will be throttled to the given value per secound.
      # To avoid package loss on UDP based transmission you should set the value to
      # (0.2 * max. Uploadspeed). We asume here an upload traffic of 819.2Kbit/s
      # 0 to disable the limit
      outbound-traffic-limit = 20KiB

      # Inbound traffic rate limit. Inbound traffic will be throttled to the given value per secound.
      # 0 to disable the limit
      inbound-traffic-limit = 0

      # Max. outbound buffer size limit. When the limit is reached, all additional messages get
      # dropped to avoid OOM exceptions.
      # We suggest to use a multiple of the max-content-length value.
      # 0 to disable the limit (can lead to OOM exceptions)
      outbound-buffer-limit = 256MB
    }

  }

  # drasyl can use shared memory to automatically discover and communicate with other nodes running
  # on the same JVM
  intra-vm-discovery.enabled = true

  # drasyl can use the file system to discover other drasyl nodes running on the local computer.
  local-host-discovery {
    # When enabled, the node writes its own information to the directory specified below. At the
    # same time, the directory is also searched for information on other nodes.
    # TODO: The discovered informations are currently not used. It will be used in a future release.
    # Therefore there is currently no reason to activate this feature.
    enabled = false

    # This directory is searched for other drasyl nodes. If nothing is specified here, a
    # "drasyl-discovery" directory in the system's temp directory will be used.
    path = ""

    # Defines how long the information written to the directory should be considered as up-to-date.
    # Older files in the directory are considered outdated and therefore will be ignored.
    # This node automatically refreshes its own information to keep them up-to-date.
    # All nodes of a directory should use the same lease time
    lease-time = 1m
  }

  # drasyl can monitor various metrics (e.g. number of known peers, children, messages received and
  # sent, etc.) and push them rate-aggregated to Influx on a periodic interval. No message contents
  # or public keys of other peers are logged.
  monitoring {
    # If activated, the node collects data and sends it to Influx
    enabled = false

    # This tag will be applied to all metrics reported to the monitoring system.  Enables filtering
    # of metrics by hostname.
    # If left blank, an attempt is made to automatically determine the local hostname.
    host-tag = ""

    influx {
      uri = "http://localhost:8086"
      user = ""
      password = ""
      database = "drasyl"
      reporting-frequency = 1m
    }
  }

  # Every plugin that should be auto-loaded by drasyl, must be added to this object as object.
  # Only plugins that extends the AutoloadablePlugin class can be auto-loaded by drasyl.
  # The selected key for the object is also the path where all configurations are
  # provided to the plugin.
  # Example:
  # "org.drasyl.plugin.TestPlugin" {
  #  enabled = true
  # }
  plugins {}

  # drasyl can automatically (un-) marshall given objects. To prevent security risks through
  # unrestricted marshalling, types and packages can be defined here that are handled automatically.
  # drasyl differs between in- and outbound messages.
  #
  # A reckless implementation of a permitted class can leave the entire application and all
  # executing machines vulnerable to remote code execution.
  #
  # An attacker is in general interested in all "non-pure" methods, which have promising side
  # effects. A method is "pure" if:
  #   - The execution of the function has no side effects, and
  #   - the return value of the function depends only on the input parameters passed to the function.
  #
  # For example, a vulnerability could be a setter or getter that connects to a database.
  # A vulnerable class is for example the ch.qos.logback.core.db.DriverManagerConnectionSource.
  # An attacker can choose the URL arbitrarily. By calling getConnection,
  # Server Side Request Forgery (SSRF) and DOS attacks can occur.
  #
  # You can find more about this in the following literature:
  #   - Java Unmarshaller Security - Turning your data into code execution by Moritz Bechler:
  #     https://raw.githubusercontent.com/mbechler/marshalsec/master/marshalsec.pdf
  #   - Automated Discovery of Deserialization Gadget Chains by Ian Haken:
  #     https://i.blackhat.com/us-18/Thu-August-9/us-18-Haken-Automated-Discovery-of-Deserialization-Gadget-Chains-wp.pdf
  #   - Marshalling Pickles by Chris Frohoff and Garbriel Lawrence:
  #     https://frohoff.github.io/appseccali-marshalling-pickles/
  marshalling {
    inbound {
      # A list of all types that are supported by codec for the drasyl pipeline
      # With this list, a developer guarantees that all classes are secure and cannot be misused as a
      # deserialization gadget in the context of the marshaller.
      allowed-types = [
        "java.lang.Number",
        "java.lang.String"
      ]

      # Whether Java's primitive data types should automatically be allowed
      allow-all-primitives = true

      # Whether of all allowed data types their array representations should be allowed automatically
      allow-array-of-defined-types = true

      # A list of all packages whose classes automatically supported by the default codec of drasyl
      allowed-packages = []
    }

    outbound {
      # A list of all types that are supported by codec for the drasyl pipeline
      # With this list, a developer guarantees that all classes are secure and cannot be misused as a
      # deserialization gadget in the context of the marshaller.
      allowed-types = [
        "java.lang.Number",
        "java.lang.String"
      ]

      # Whether Java's primitive data types should automatically be allowed
      allow-all-primitives = true

      # Whether of all allowed data types their array representations should be allowed automatically
      allow-array-of-defined-types = true

      # A list of all packages whose classes automatically supported by the default codec of drasyl
      allowed-packages = []
    }
  }
}