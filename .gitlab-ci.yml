stages:
  - build
  - test
  - deploy
  - docker-build
  - docker-test
  - review
  - dast

include:
  - local: /.gitlab-ci/Maven.gitlab-ci.yml # we have to use our own template, since GitLab's template uses JDK8, but we need JDK11
  - template: Docker.gitlab-ci.yml
  - local: /.gitlab-ci/Deployments.gitlab-ci.yml
  - template: SAST.gitlab-ci.yml
  - template: DAST.gitlab-ci.yml
  - template: Dependency-Scanning.gitlab-ci.yml
  - template: Container-Scanning.gitlab-ci.yml
  - template: License-Scanning.gitlab-ci.yml
  - template: Code-Quality.gitlab-ci.yml

docker-build-master:
  stage: docker-build

docker-build:
  stage: docker-build

sast:
  variables:
    SAST_JAVA_VERSION: 11
  only:
    variables:
      - $SAST_ENABLED

dast:
  variables:
    DAST_WEBSITE: https://staging.env.drasyl.org/
  only:
    variables:
      - $DAST_ENABLED

dependency_scanning:
  only:
    variables:
      - $DEPENDENCY_SCANNING_ENABLED

container_scanning:
  stage: docker-test
  only:
    variables:
      - $CONTAINER_SCANNING_ENABLED

license_scanning:
  stage: build
  variables:
    MAVEN_CLI_OPTS: -DskipTests
    LM_JAVA_VERSION: 11
  only:
    variables:
      - $LICENSE_MANAGEMENT_ENABLED

code_quality:
  only:
    variables:
      - $CODE_QUALITY_ENABLED