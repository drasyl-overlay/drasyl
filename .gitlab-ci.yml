stages:
  - build
  - test
  - docker-build
  - docker-test
  - deploy

include:
  - local: /.gitlab-ci/Maven.gitlab-ci.yml # we have to use our own template, since GitLab's template uses JDK8, but we need JDK11
  - template: Dependency-Scanning.gitlab-ci.yml
  #  - template: Code-Quality.gitlab-ci.yml
  - local: /.gitlab-ci/Docker.gitlab-ci.yml
  - template: Container-Scanning.gitlab-ci.yml
  - template: License-Scanning.gitlab-ci.yml
  #  - template: SAST.gitlab-ci.yml
  - local: /.gitlab-ci/Deployments.gitlab-ci.yml

license_scanning:
  stage: build
  variables:
    MAVEN_CLI_OPTS: -DskipTests
    LM_JAVA_VERSION: 11
  only:
    variables:
      - $LICENSE_MANAGEMENT_ENABLED

container_scanning:
  stage: docker-test
  only:
    variables:
      - $CONTAINER_SCANNING_ENABLED

dependency_scanning:
  only:
    variables:
      - $DEPENDENCY_SCANNING_ENABLED

#sast:
#  variables:
#    MAVEN_CLI_OPTS: -DskipTests
#    SAST_JAVA_VERSION: 11
